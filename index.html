<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èµ¶é£æœºè®¡ç®—å™¨</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* è‡ªå®šä¹‰æ»‘å—æ ·å¼ */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #3b82f6; /* blue-500 */
            border: 4px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            margin-top: -9px; /* å‚ç›´å±…ä¸­ */
            cursor: pointer;
            position: relative;
            z-index: 20;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #e2e8f0; /* slate-200 */
            border-radius: 3px;
        }
        
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ (Chrome/Safari) */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* éšè—æ»šåŠ¨æ¡ (Firefox) */
        .hide-scrollbar {
            scrollbar-width: none;
        }

        body {
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8fafc;
        }
    </style>
</head>
<body class="text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CarIcon = () => <div className="text-xl leading-none">ğŸš–</div>;
        const LuggageIcon = () => <div className="text-xl leading-none">ğŸ§³</div>;
        const PoliceIcon = () => <div className="text-xl leading-none">ğŸ‘®</div>;
        const BurgerIcon = () => <div className="text-xl leading-none">ğŸ”</div>;
        const WalkIcon = () => <div className="text-xl leading-none">ğŸš¶</div>;
        const PlaneTakeoffIcon = () => <div className="text-xl leading-none">ğŸ›«</div>;
        
        const GearIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-400 fill-current">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                <circle cx="12" cy="12" r="3" />
            </svg>
        );

        // --- å®šåˆ¶çš„å¤§å·æ—¶é—´é€‰æ‹©å™¨ ---
        const CustomTimePicker = ({ value, onChange, onClose }) => {
            const [selectedHour, setSelectedHour] = useState(value.split(':')[0]);
            const [selectedMinute, setSelectedMinute] = useState(value.split(':')[1]);
            
            // ç”Ÿæˆå°æ—¶å’Œåˆ†é’Ÿæ•°ç»„
            const hours = Array.from({ length: 24 }, (_, i) => i.toString().padStart(2, '0'));
            const minutes = Array.from({ length: 60 }, (_, i) => i.toString().padStart(2, '0'));

            // è‡ªåŠ¨æ»šåŠ¨åˆ°é€‰ä¸­ä½ç½®çš„ Ref
            const hourListRef = useRef(null);
            const minuteListRef = useRef(null);

            useEffect(() => {
                // æ‰“å¼€æ—¶æ»šåŠ¨åˆ°å½“å‰é€‰ä¸­æ—¶é—´
                const hEl = document.getElementById(`hour-${selectedHour}`);
                const mEl = document.getElementById(`minute-${selectedMinute}`);
                if (hEl && hourListRef.current) {
                    hourListRef.current.scrollTop = hEl.offsetTop - hourListRef.current.offsetTop - 100;
                }
                if (mEl && minuteListRef.current) {
                    minuteListRef.current.scrollTop = mEl.offsetTop - minuteListRef.current.offsetTop - 100;
                }
            }, []);

            const handleConfirm = () => {
                onChange(`${selectedHour}:${selectedMinute}`);
                onClose();
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in" onClick={onClose}>
                    {/* é¢æ¿ä¸»ä½“ */}
                    <div 
                        className="bg-white w-full sm:w-96 h-[50vh] sm:h-[60vh] rounded-t-3xl sm:rounded-3xl shadow-2xl flex flex-col overflow-hidden" 
                        onClick={(e) => e.stopPropagation()}
                    >
                        {/* é¡¶éƒ¨æ“ä½œæ  */}
                        <div className="flex justify-between items-center px-6 py-4 border-b border-slate-100 bg-slate-50">
                            <button onClick={onClose} className="text-slate-500 text-sm font-medium p-2">å–æ¶ˆ</button>
                            <span className="text-lg font-bold text-slate-700">é€‰æ‹©èµ·é£æ—¶é—´</span>
                            <button onClick={handleConfirm} className="text-blue-600 text-sm font-bold bg-blue-50 px-4 py-2 rounded-full">ç¡®å®š</button>
                        </div>

                        {/* é€‰æ‹©åŒºåŸŸ - ä¸¤åˆ—å¸ƒå±€ */}
                        <div className="flex-1 flex overflow-hidden relative">
                            {/* é€‰ä¸­é«˜äº®æ¡ (è§†è§‰è¾…åŠ©) */}
                            <div className="absolute top-1/2 left-0 right-0 h-12 bg-blue-50 -translate-y-1/2 pointer-events-none border-y border-blue-100"></div>

                            {/* å°æ—¶åˆ— */}
                            <div className="flex-1 flex flex-col h-full border-r border-slate-50">
                                <div className="text-center text-xs text-slate-400 py-2 font-medium bg-white z-10">å°æ—¶</div>
                                <div className="flex-1 overflow-y-auto hide-scrollbar scroll-smooth pb-[50%]" ref={hourListRef}>
                                    <div className="h-[40%]"></div> {/* é¡¶éƒ¨å ä½ */}
                                    {hours.map(h => (
                                        <div 
                                            key={h} 
                                            id={`hour-${h}`}
                                            onClick={() => setSelectedHour(h)}
                                            className={`py-3 text-center text-xl cursor-pointer transition-all duration-200 select-none ${
                                                selectedHour === h 
                                                ? 'font-bold text-blue-600 scale-125' 
                                                : 'text-slate-400 hover:text-slate-600'
                                            }`}
                                        >
                                            {h}
                                        </div>
                                    ))}
                                    <div className="h-[40%]"></div> {/* åº•éƒ¨å ä½ */}
                                </div>
                            </div>

                            {/* åˆ†é’Ÿåˆ— */}
                            <div className="flex-1 flex flex-col h-full">
                                <div className="text-center text-xs text-slate-400 py-2 font-medium bg-white z-10">åˆ†é’Ÿ</div>
                                <div className="flex-1 overflow-y-auto hide-scrollbar scroll-smooth pb-[50%]" ref={minuteListRef}>
                                    <div className="h-[40%]"></div>
                                    {minutes.map(m => (
                                        <div 
                                            key={m} 
                                            id={`minute-${m}`}
                                            onClick={() => setSelectedMinute(m)}
                                            className={`py-3 text-center text-xl cursor-pointer transition-all duration-200 select-none ${
                                                selectedMinute === m 
                                                ? 'font-bold text-blue-600 scale-125' 
                                                : 'text-slate-400 hover:text-slate-600'
                                            }`}
                                        >
                                            {m}
                                        </div>
                                    ))}
                                    <div className="h-[40%]"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const SliderRow = ({ icon, title, value, setValue, min, max, leftLabel, rightLabel }) => {
            return (
                <div className="py-4">
                    <div className="flex justify-between items-center mb-3">
                        <div className="flex items-center gap-3 font-medium text-slate-800">
                            {icon}
                            <span className="text-base font-bold">{title}</span>
                        </div>
                        <div className="font-bold text-slate-800 text-lg">
                            {value} <span className="text-sm font-normal text-slate-500">åˆ†é’Ÿ</span>
                        </div>
                    </div>
                    
                    <div className="relative h-6 flex items-center mb-1">
                        <input 
                            type="range" 
                            min={min} 
                            max={max} 
                            step="5"
                            value={value}
                            onChange={(e) => setValue(Number(e.target.value))}
                            className="w-full z-10"
                        />
                        <div 
                            className="absolute h-[6px] bg-blue-400 rounded-l-full pointer-events-none top-1/2 transform -translate-y-1/2 left-0"
                            style={{ width: `${((value - min) / (max - min)) * 100}%` }}
                        ></div>
                    </div>

                    <div className="flex justify-between text-[10px] sm:text-xs text-slate-400 leading-tight">
                        <span className="font-bold text-slate-700">{leftLabel}</span>
                        <span className="text-slate-400 max-w-[50%] text-right">{rightLabel}</span>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [flightTime, setFlightTime] = useState('14:30');
            const [showPicker, setShowPicker] = useState(false); // æ§åˆ¶è‡ªå®šä¹‰é€‰æ‹©å™¨æ˜¾ç¤º
            
            const [commuteMinutes, setCommuteMinutes] = useState(50);
            const [checkInMinutes, setCheckInMinutes] = useState(0);
            const [securityMinutes, setSecurityMinutes] = useState(20);
            const [diningMinutes, setDiningMinutes] = useState(20); 
            const [walkMinutes, setWalkMinutes] = useState(10);
            const [boardingBuffer, setBoardingBuffer] = useState(40);

            const [result, setResult] = useState(null);

            useEffect(() => {
                if (!flightTime) return;

                const [hours, minutes] = flightTime.split(':').map(Number);
                const takeoffDate = new Date();
                takeoffDate.setHours(hours, minutes, 0, 0);

                const gateArrival = new Date(takeoffDate.getTime() - boardingBuffer * 60000);
                const startWalk = new Date(gateArrival.getTime() - walkMinutes * 60000);
                const finishSecurity = new Date(startWalk.getTime() - diningMinutes * 60000);
                const finishCheckIn = new Date(finishSecurity.getTime() - securityMinutes * 60000);
                const arriveAirport = new Date(finishCheckIn.getTime() - checkInMinutes * 60000);
                const leaveHome = new Date(arriveAirport.getTime() - commuteMinutes * 60000);

                const totalMinutes = commuteMinutes + checkInMinutes + securityMinutes + diningMinutes + walkMinutes + boardingBuffer;

                setResult({
                    leaveHome,
                    arriveAirport,
                    finishCheckIn,
                    finishSecurity,
                    startWalk,
                    gateArrival,
                    takeoffDate,
                    totalMinutes
                });

            }, [flightTime, commuteMinutes, checkInMinutes, securityMinutes, diningMinutes, walkMinutes, boardingBuffer]);

            const formatTime = (date) => {
                return date ? date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false }) : '--:--';
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex justify-center">
                    <div className="w-full max-w-md bg-white min-h-screen shadow-xl flex flex-col relative">
                        
                        {/* è“è‰²å¤´éƒ¨ */}
                        <div className="bg-[#3b82f6] text-white pt-8 pb-10 px-6 relative z-10">
                            
                            {/* æ ‡é¢˜åŒº */}
                            <div className="flex items-center justify-center gap-3 mb-8">
                                <span className="text-5xl leading-none">âœˆï¸</span>
                                <div className="flex flex-col items-start">
                                    <h1 className="text-2xl font-bold tracking-widest leading-tight">èµ¶é£æœºè®¡ç®—å™¨</h1>
                                    <p className="text-blue-100 text-xs tracking-wider opacity-90 leading-tight mt-1">å€’æ¨æ—¶é—´ï¼Œä»å®¹å‡ºå‘</p>
                                </div>
                            </div>

                            {/* å¡ç‰‡åŒºåŸŸ - ä½¿ç”¨ä¸‰æ å¼¹æ€§å¸ƒå±€å®ç°å®Œç¾é—´è· */}
                            <div className="flex items-stretch w-full">
                                
                                {/* å·¦ä¾§ï¼šèµ·é£æ—¶é—´å¡ç‰‡ */}
                                <div 
                                    className="flex-1 bg-white text-slate-800 rounded-lg p-2 aspect-[4/3] flex flex-col items-center justify-center shadow-lg relative active:scale-95 transition-transform group cursor-pointer"
                                    onClick={() => setShowPicker(true)}
                                >
                                    <div className="text-sm text-slate-500 mb-2 flex items-center justify-center gap-1">
                                        èµ·é£æ—¶é—´ 
                                        <span className="text-[10px] text-[#3b82f6] bg-blue-50 px-1.5 py-0.5 rounded font-medium">ä¿®æ”¹</span>
                                    </div>
                                    
                                    <div className="text-5xl font-bold font-sans tracking-tight text-slate-900 group-active:scale-105 transition-transform">
                                        {flightTime}
                                    </div>
                                </div>

                                {/* ä¸­é—´ï¼šç®­å¤´å ä½ç¬¦ (å®šå®½12 = 48px) */}
                                <div className="w-12 flex items-center justify-center text-white opacity-80 shrink-0">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M8 5v14l11-7z" />
                                    </svg>
                                </div>

                                {/* å³ä¾§ï¼šå‡ºé—¨æ—¶é—´å¡ç‰‡ */}
                                <div className="flex-1 bg-orange-500 text-white rounded-lg p-2 aspect-[4/3] flex flex-col items-center justify-center shadow-lg border-2 border-orange-500">
                                    <span className="text-sm text-white mb-2 opacity-90">å‡ºé—¨æ—¶é—´</span>
                                    <div className="text-5xl font-bold font-sans tracking-tight">
                                        {result ? formatTime(result.leaveHome) : '--:--'}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* æ€»è€—æ—¶åŒºåŸŸ */}
                        <div className="text-center mt-8 px-6 mb-4">
                            <h2 className="text-xl font-bold text-slate-800 tracking-tight">
                                å…¨ç¨‹é¢„è®¡è€—æ—¶ : {result ? result.totalMinutes : 0}åˆ†é’Ÿ
                            </h2>
                            
                            <div className="relative flex items-center justify-center mt-6 mb-2">
                                <div className="absolute inset-0 flex items-center">
                                    <div className="w-full border-t border-slate-300"></div>
                                </div>
                                <div className="relative bg-white px-3 text-sm font-bold text-slate-600 flex items-center gap-2">
                                    <GearIcon /> å‚æ•°è°ƒæ•´
                                </div>
                            </div>
                        </div>

                        {/* å‚æ•°è°ƒæ•´åˆ—è¡¨ */}
                        <div className="flex-1 px-6 pb-8 space-y-1 overflow-y-auto">
                            <SliderRow 
                                icon={<CarIcon />}
                                title="å‰å¾€æœºåœºè€—æ—¶"
                                value={commuteMinutes} setValue={setCommuteMinutes} min={10} max={180}
                                leftLabel={`${result ? formatTime(result.arriveAirport) : '--'} åˆ°è¾¾æœºåœº`} rightLabel="è¯·æå‰æŸ¥è¯¢è·¯å†µ"
                            />
                            <SliderRow 
                                icon={<LuggageIcon />}
                                title="å€¼æœº/æ‰˜è¿è€—æ—¶"
                                value={checkInMinutes} setValue={setCheckInMinutes} min={0} max={120}
                                leftLabel={`${result ? formatTime(result.finishCheckIn) : '--'} å€¼æœº/æ‰˜è¿ å®Œæˆ`} rightLabel="æ‰‹æœºå€¼æœºä¸”æ— æ‰˜è¿å¯è®¾ä¸º0"
                            />
                            <SliderRow 
                                icon={<PoliceIcon />}
                                title="å®‰æ£€/é€šå…³è€—æ—¶"
                                value={securityMinutes} setValue={setSecurityMinutes} min={10} max={120}
                                leftLabel={`${result ? formatTime(result.finishSecurity) : '--'} å®‰æ£€/é€šå…³ å®Œæˆ`} rightLabel="å›½é™…å‡ºå‘é€šå…³éœ€é…Œæƒ…å¢åŠ "
                            />
                            <SliderRow 
                                icon={<BurgerIcon />}
                                title="åƒé¥­/ä¼‘æ¯å®¤åœç•™"
                                value={diningMinutes} setValue={setDiningMinutes} min={0} max={180}
                                leftLabel={`${result ? formatTime(result.startWalk) : '--'} å‘ç™»æœºå£å‡ºå‘`} rightLabel="å›½é™…å‡ºå‘é€šå…³éœ€é…Œæƒ…å¢åŠ "
                            />
                            <SliderRow 
                                icon={<WalkIcon />}
                                title="æ­¥è¡Œè‡³ç™»æœºå£æ—¶é—´"
                                value={walkMinutes} setValue={setWalkMinutes} min={5} max={60}
                                leftLabel={`${result ? formatTime(result.gateArrival) : '--'} æŠµè¾¾ç™»æœºå£`} rightLabel="æ ¹æ®æœºåœºå¤§å°åŠæ˜¯å¦ä½¿ç”¨ä¼‘æ¯å®¤è®¾å®š"
                            />
                            <SliderRow 
                                icon={<PlaneTakeoffIcon />}
                                title="ç™»æœºè‡³èµ·é£æ—¶é—´"
                                value={boardingBuffer} setValue={setBoardingBuffer} min={20} max={60}
                                leftLabel={`${flightTime} èµ·é£`} rightLabel="é€šå¸¸ç™»æœºæ—¶é—´ä¸ºèµ·é£å‰40~50åˆ†é’Ÿ"
                            />
                        </div>

                        {/* åº•éƒ¨ */}
                        <div className="text-center pb-8 pt-4 px-6 text-xs text-slate-500 leading-relaxed font-medium">
                            <p>è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œè¯·é¢„ç•™å……è¶³æ—¶é—´</p>
                            <p>ç¥ä½ æ—…é€”æ„‰å¿«ï¼</p>
                        </div>

                        {/* è‡ªå®šä¹‰æ—¶é—´é€‰æ‹©å™¨ (Portal) */}
                        {showPicker && (
                            <CustomTimePicker 
                                value={flightTime}
                                onChange={setFlightTime}
                                onClose={() => setShowPicker(false)}
                            />
                        )}

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>